@model CodeGrade.Models.Grade
@{
    ViewData["Title"] = "Детайли на оценка";
}

<div class="bg-white shadow rounded-lg">
    <div class="px-4 py-5 sm:p-6">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-2xl font-bold text-gray-900">Детайли на оценка</h2>
            <div class="flex space-x-3">
                <a href="/Grades/Edit/@Model.Id" class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md text-white bg-indigo-600 hover:bg-indigo-700">
                    <i class="fas fa-edit mr-2"></i>
                    Редактирай
                </a>
                <a href="/Grades" class="inline-flex items-center px-4 py-2 border border-gray-300 text-sm font-medium rounded-md text-gray-700 bg-white hover:bg-gray-50">
                    <i class="fas fa-arrow-left mr-2"></i>
                    Назад
                </a>
            </div>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Информация за ученика -->
            <div class="bg-gray-50 rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Информация за ученика</h3>
                <div class="space-y-3">
                    <div>
                        <span class="text-sm font-medium text-gray-500">Име:</span>
                        <span class="ml-2 text-sm text-gray-900">
                            @if (Model.Student?.User != null)
                            {
                                @Model.Student.User.FirstName @Model.Student.User.LastName
                            }
                            else
                            {
                                <span class="text-gray-400">Няма данни</span>
                            }
                        </span>
                    </div>
                    <div>
                        <span class="text-sm font-medium text-gray-500">Клас:</span>
                        <span class="ml-2 text-sm text-gray-900">
                            @if (Model.Student?.ClassGroup != null)
                            {
                                @($"{Model.Student.ClassGroup.Name} - {Model.Student.ClassNumber}")
                            }
                            else
                            {
                                <span class="text-gray-400">Няма данни</span>
                            }
                        </span>
                    </div>
                    <div>
                        <span class="text-sm font-medium text-gray-500">Email:</span>
                        <span class="ml-2 text-sm text-gray-900">
                            @if (Model.Student?.User != null)
                            {
                                @Model.Student.User.Email
                            }
                            else
                            {
                                <span class="text-gray-400">Няма данни</span>
                            }
                        </span>
                    </div>
                </div>
            </div>

            <!-- Информация за задачата -->
            <div class="bg-gray-50 rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Информация за задачата</h3>
                <div class="space-y-3">
                    <div>
                        <span class="text-sm font-medium text-gray-500">Заглавие:</span>
                        <span class="ml-2 text-sm text-gray-900">@Model.Assignment?.Title</span>
                    </div>
                    <div>
                        <span class="text-sm font-medium text-gray-500">Описание:</span>
                        <span class="ml-2 text-sm text-gray-900">@Model.Assignment?.Description</span>
                    </div>
                    <div>
                        <span class="text-sm font-medium text-gray-500">Език:</span>
                        <span class="ml-2 text-sm text-gray-900">@Model.Assignment?.Language</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Оценка -->
        <div class="mt-6 bg-gray-50 rounded-lg p-6">
            <h3 class="text-lg font-medium text-gray-900 mb-4">Оценка</h3>
            <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                <div>
                    <span class="text-sm font-medium text-gray-500">Точки:</span>
                    <div class="mt-1">
                        <span class="text-2xl font-bold text-gray-900">@Model.Points/100</span>
                    </div>
                </div>
                <div>
                    <span class="text-sm font-medium text-gray-500">6-бална оценка:</span>
                    <div class="mt-1">
                        @if (Model.GradeValue.HasValue)
                        {
                            <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium 
                                @(Model.GradeValue >= 5.5m ? "bg-green-100 text-green-800" : 
                                  Model.GradeValue >= 4.5m ? "bg-blue-100 text-blue-800" : 
                                  Model.GradeValue >= 3.5m ? "bg-yellow-100 text-yellow-800" : 
                                  Model.GradeValue >= 3.0m ? "bg-orange-100 text-orange-800" : 
                                  "bg-red-100 text-red-800")">
                                @Model.GradeValue
                            </span>
                        }
                        else
                        {
                            <span class="text-gray-400">Не е зададена</span>
                        }
                    </div>
                </div>
                <div>
                    <span class="text-sm font-medium text-gray-500">Процент:</span>
                    <div class="mt-1">
                        @{
                            var percentage = (double)Model.Points / 100 * 100;
                        }
                        <span class="inline-flex items-center px-3 py-1 rounded-full text-sm font-medium 
                            @(percentage >= 80 ? "bg-green-100 text-green-800" : 
                              percentage >= 60 ? "bg-yellow-100 text-yellow-800" : 
                              "bg-red-100 text-red-800")">
                            @percentage.ToString("F1")%
                        </span>
                    </div>
                </div>
            </div>
            @if (!string.IsNullOrEmpty(Model.Comments))
            {
                <div class="mt-4">
                    <span class="text-sm font-medium text-gray-500">Коментари:</span>
                    <div class="mt-1 p-3 bg-white rounded border">
                        <p class="text-sm text-gray-900">@Model.Comments</p>
                    </div>
                </div>
            }
            <div class="mt-4">
                <span class="text-sm font-medium text-gray-500">Дата на оценяване:</span>
                <span class="ml-2 text-sm text-gray-900">@Model.GradedAt.ToString("dd.MM.yyyy HH:mm")</span>
            </div>
        </div>

        <!-- Резултати от изпълнение -->
        @{
            var execResults = ViewBag.Submission != null ? (ICollection<CodeGrade.Models.ExecutionResult>)ViewBag.Submission.ExecutionResults : null;
        }
        @if (execResults != null && execResults.Count > 0)
        {
            <div class="mt-6 bg-gray-50 rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Резултати от изпълнение</h3>
                <div class="space-y-4">
                    @foreach (var result in execResults)
                    {
                        <div class="bg-white rounded border p-4">
                            <div class="flex justify-between items-start">
                                <div>
                                                                <h4 class="font-medium text-gray-900">
                                Тест @(result.TestCase?.Id ?? 0): @(result.TestCase?.Description ?? "Без описание")
                            </h4>
                                    @if (!string.IsNullOrEmpty(result.TestCase?.Description))
                                    {
                                        <p class="text-sm text-gray-600 mt-1">@result.TestCase.Description</p>
                                    }
                                </div>
                                                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium 
                            @(result.Status == ExecutionStatus.Passed ? "bg-green-100 text-green-800" : 
                              result.Status == ExecutionStatus.Failed ? "bg-red-100 text-red-800" : 
                              "bg-yellow-100 text-yellow-800")">
                            @result.Status
                        </span>
                            </div>
                                                @if (!string.IsNullOrEmpty(result.ActualOutput))
                    {
                        <div class="mt-3">
                            <span class="text-sm font-medium text-gray-500">Изход:</span>
                            <pre class="mt-1 p-2 bg-gray-100 rounded text-sm text-gray-900 overflow-x-auto">@result.ActualOutput</pre>
                        </div>
                    }
                            @if (!string.IsNullOrEmpty(result.ExpectedOutput))
                            {
                                <div class="mt-2">
                                    <span class="text-sm font-medium text-gray-500">Очакван изход:</span>
                                    <pre class="mt-1 p-2 bg-gray-100 rounded text-sm text-gray-900 overflow-x-auto">@result.ExpectedOutput</pre>
                                </div>
                            }
                        </div>
                    }
                </div>
            </div>
        }

        <!-- Код на ученика -->
        @if (ViewBag.Submission != null && !string.IsNullOrEmpty(ViewBag.Submission.Code))
        {
            <div class="mt-6 bg-gray-50 rounded-lg p-6">
                <h3 class="text-lg font-medium text-gray-900 mb-4">Код на ученика</h3>
                <pre class="bg-gray-900 text-green-400 p-4 rounded overflow-x-auto text-sm">@ViewBag.Submission.Code</pre>
            </div>
        }
    </div>
</div> 